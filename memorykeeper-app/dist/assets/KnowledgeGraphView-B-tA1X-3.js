import{r as l,u as G,c as O,a4 as Z,a5 as _,a6 as V,j as e,h as $,a7 as q,a8 as U,a9 as X,aa as Y,a as H,ab as J,ac as Q}from"./ai-studio-D1VHpCnl.js";const ne=({onBack:E})=>{const f=l.useRef(null),[d,M]=l.useState([]),[w,D]=l.useState([]),[n,v]=l.useState(null),[ee,se]=l.useState(!1),[te,re]=l.useState(null),[m,j]=l.useState(1),[x,T]=l.useState({x:0,y:0}),[g,z]=l.useState(""),[R,A]=l.useState("all"),[k,C]=l.useState(!1),{state:h}=G(),{addToast:K}=O(),S=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA"];l.useEffect(()=>{h.memories.length!==0&&L()},[h.memories]);const L=async()=>{C(!0);const r=[],s=[];for(let t=0;t<h.memories.length;t++){const a=h.memories[t],o=t/h.memories.length*2*Math.PI,i=Math.min(300,h.memories.length*30),u=Math.cos(o)*i+400,p=Math.sin(o)*i+300;let y=[],b="neutral";try{const c=await Z(a);c.success&&c.keywords&&(y=c.keywords);const N=await _(a);N.success&&N.sentiment&&(b=N.sentiment)}catch(c){console.warn("Failed to analyze memory with AI:",c)}r.push({id:a.id||`memory-${t}`,x:u,y:p,memory:a,connections:[],color:S[t%S.length],keywords:y,sentiment:b})}for(let t=0;t<r.length;t++)for(let a=t+1;a<r.length;a++){const o=await W(r[t],r[a]);o&&o.type!=="none"&&o.strength>20&&(s.push(o),r[t].connections.push(r[a].id),r[a].connections.push(r[t].id))}M(r),D(s),C(!1)},W=async(r,s)=>{try{const t=await V(r.memory,s.memory);return t.success&&t.connectionType&&t.strength?{from:r.id,to:s.id,strength:t.strength/100,type:t.connectionType}:F(r,s)}catch(t){return console.warn("AI connection analysis failed, using basic analysis:",t),F(r,s)}},F=(r,s)=>{const t=r.memory,a=s.memory,o=new Date(t.date||t.created_at),i=new Date(a.date||a.created_at),p=Math.abs(o.getTime()-i.getTime())/(1e3*60*60*24);if(p<=7)return{from:r.id,to:s.id,strength:Math.max(.3,1-p/7),type:"temporal"};if(r.keywords&&s.keywords){const y=r.keywords.filter(b=>{var c;return(c=s.keywords)==null?void 0:c.includes(b)});if(y.length>0)return{from:r.id,to:s.id,strength:Math.min(1,y.length*.2),type:"keyword"}}return r.sentiment&&s.sentiment&&r.sentiment===s.sentiment&&r.sentiment!=="neutral"?{from:r.id,to:s.id,strength:.4,type:"emotional"}:null};l.useEffect(()=>{const r=f.current;if(!r)return;const s=r.getContext("2d");s&&(s.clearRect(0,0,r.width,r.height),s.save(),s.translate(x.x,x.y),s.scale(m,m),w.forEach(t=>{const a=d.find(i=>i.id===t.from),o=d.find(i=>i.id===t.to);if(a&&o){switch(s.beginPath(),s.moveTo(a.x,a.y),s.lineTo(o.x,o.y),t.type){case"temporal":s.strokeStyle="#3B82F6",s.lineWidth=2;break;case"keyword":s.strokeStyle="#10B981",s.lineWidth=2;break;case"emotional":s.strokeStyle="#F59E0B",s.lineWidth=2;break;case"thematic":s.strokeStyle="#8B5CF6",s.lineWidth=2;break;default:s.strokeStyle="#6B7280",s.lineWidth=1}s.globalAlpha=t.strength*.6,s.stroke(),s.globalAlpha=1}}),d.forEach(t=>{if(g&&!t.memory.prompt.toLowerCase().includes(g.toLowerCase())&&!t.memory.response.toLowerCase().includes(g.toLowerCase()))return;s.beginPath(),s.arc(t.x,t.y,25,0,2*Math.PI),(n==null?void 0:n.id)===t.id?(s.fillStyle="#FFFFFF",s.strokeStyle=t.color,s.lineWidth=3):(s.fillStyle=t.color,s.strokeStyle="#FFFFFF",s.lineWidth=2),s.fill(),s.stroke(),s.fillStyle="#1F2937",s.font="12px system-ui",s.textAlign="center";const a=t.memory.prompt.length>20?t.memory.prompt.substring(0,17)+"...":t.memory.prompt;s.fillText(a,t.x,t.y+40)}),s.restore())},[d,w,n,m,x,g]);const P=r=>{const s=f.current;if(!s)return;const t=s.getBoundingClientRect(),a=(r.clientX-t.left-x.x)/m,o=(r.clientY-t.top-x.y)/m,i=d.find(u=>Math.sqrt((u.x-a)**2+(u.y-o)**2)<=25);v(i||null)},I=()=>{j(1),T({x:0,y:0})},B=()=>{const r=f.current;if(!r)return;const s=document.createElement("a");s.download=`memory-knowledge-graph-${Date.now()}.png`,s.href=r.toDataURL(),s.click(),K({type:"success",title:"Graph Exported!",message:"Knowledge graph has been saved to your device.",duration:3e3})};return e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:E,className:"w-10 h-10 bg-white/80 backdrop-blur-xl rounded-2xl flex items-center justify-center shadow-lg border border-orange-100",children:e.jsx($,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Memory Connections"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100 mb-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search memories...",value:g,onChange:r=>z(r.target.value),className:"px-3 py-2 bg-orange-50/50 rounded-xl border border-orange-200 focus:border-orange-400 outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{value:R,onChange:r=>A(r.target.value),className:"px-3 py-2 bg-orange-50/50 rounded-xl border border-orange-200 focus:border-orange-400 outline-none",children:[e.jsx("option",{value:"all",children:"All Connections"}),e.jsx("option",{value:"temporal",children:"Time-based"}),e.jsx("option",{value:"keyword",children:"Keyword-based"}),e.jsx("option",{value:"emotional",children:"Emotional"}),e.jsx("option",{value:"thematic",children:"Thematic"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(Math.min(m*1.2,3)),className:"p-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(Math.max(m/1.2,.3)),className:"p-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:I,className:"p-2 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition-colors",children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-1 bg-blue-500 rounded"}),e.jsx("span",{children:"Time-based connections"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-1 bg-green-500 rounded"}),e.jsx("span",{children:"Keyword connections"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-1 bg-yellow-500 rounded"}),e.jsx("span",{children:"Emotional connections"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-1 bg-purple-500 rounded"}),e.jsx("span",{children:"Thematic connections"})]})]})]}),k&&e.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100 mb-6 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Analyzing memories with AI..."})]})}),e.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100 mb-6",children:e.jsx("canvas",{ref:f,width:800,height:600,className:"border border-gray-200 rounded-xl cursor-pointer bg-gray-50",onClick:P})}),n&&e.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex-shrink-0",style:{backgroundColor:n.color}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-2",children:n.memory.prompt}),e.jsx("p",{className:"text-gray-600 mb-3",children:n.memory.response}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["ðŸ“… ",new Date(n.memory.date||n.memory.created_at).toLocaleDateString()]}),e.jsxs("span",{children:["ðŸ”— ",n.connections.length," connections"]}),n.sentiment&&e.jsxs("span",{children:["ðŸ˜Š Sentiment: ",n.sentiment]})]}),n.keywords&&n.keywords.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-1",children:"Keywords:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.keywords.map((r,s)=>e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs",children:r},s))})]}),n.connections.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Connected Memories:"}),e.jsx("div",{className:"space-y-2",children:n.connections.slice(0,3).map(r=>{const s=d.find(a=>a.id===r);if(!s)return null;const t=w.find(a=>a.from===n.id&&a.to===r||a.from===r&&a.to===n.id);return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-gray-600 truncate",children:s.memory.prompt}),e.jsxs("span",{className:"text-xs text-gray-400 ml-auto",children:[t==null?void 0:t.type," (",Math.round(((t==null?void 0:t.strength)||0)*100),"%)"]})]},r)})})]})]})]})}),d.length===0&&!k&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-orange-100 text-center",children:[e.jsx(Q,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Memories to Connect"}),e.jsx("p",{className:"text-gray-600",children:"Add some memories first to see how they connect and form your personal knowledge graph."})]})]})};export{ne as default};
//# sourceMappingURL=KnowledgeGraphView-B-tA1X-3.js.map
