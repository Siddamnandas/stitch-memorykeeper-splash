const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/game-components-DlDolkYV.js","assets/ai-studio-D1VHpCnl.js"])))=>i.map(i=>d[i]);
import{c as $,u as C,r as g,j as e,h as P,y as b,aw as M,au as y,av as E,k as A}from"./ai-studio-D1VHpCnl.js";import{h as _,_ as z,d as D,a as W}from"./game-components-DlDolkYV.js";import{b as L,d as O,F as R}from"./index-BYmrHuMl.js";const G=async(t,d,i={})=>{const s={success:!1,importedMemories:0,failedImports:0,errors:[],processedFiles:t},l={autoTag:i.autoTag??!0,preserveDates:i.preserveDates??!1,generatePrompts:i.generatePrompts??!0,batchSize:i.batchSize??5};try{for(let a=0;a<t.length;a+=l.batchSize){const r=t.slice(a,a+l.batchSize);await Promise.all(r.map(c=>U(c,d,l,s)))}s.success=s.failedImports===0}catch(a){s.errors.push(`Import failed: ${a.message}`),console.error("Memory import error:",a)}return s},U=async(t,d,i,s)=>{try{const l=await j(t,i);for(const a of l)try{const r=O({prompt:a.prompt,response:a.response,type:a.type,tags:a.tags}),c={id:`import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,prompt:r.prompt,response:r.response,date:a.date||new Date().toISOString(),type:r.type,tags:r.tags},x=await _(c,d);if(x.error)throw new Error(`Database error: ${x.error.message}`);try{const{getActivityPoints:p}=await z(async()=>{const{getActivityPoints:n}=await import("./game-components-DlDolkYV.js").then(h=>h.y);return{getActivityPoints:n}},__vite__mapDeps([0,1]));await D(d,{type:"memory_imported",timestamp:new Date,value:p("memory_imported"),metadata:{importSource:t.metadata.name,memoryId:c.id}})}catch(p){console.warn("Failed to update memory strength:",p)}s.importedMemories++}catch(r){s.failedImports++,s.errors.push(`Failed to import memory from ${t.metadata.name}: ${r.message}`)}}catch(l){s.failedImports++,s.errors.push(`Failed to process ${t.metadata.name}: ${l.message}`)}},j=async(t,d)=>{const i=[];if(t.type==="image"){const s=f(t.metadata.name,d);i.push({prompt:s,response:`Image imported: ${t.metadata.name}`,type:"visual",tags:N(t.metadata.name,d),date:d.preserveDates?new Date(t.metadata.lastModified).toISOString():void 0})}else if(t.type==="document"&&t.textContent){const s=await v(t.textContent,t.metadata.name,d);i.push(...s)}return i},f=(t,d)=>{if(!d.generatePrompts)return`Imported image: ${t}`;const s=t.replace(/\.[^/.]+$/,"").replace(/[-_]/g," ");return s.match(/\b\d{4}\b/)?`Describe this photo from ${s}`:s.toLowerCase().includes("family")||s.toLowerCase().includes("wedding")?`Tell me about this ${s.toLowerCase()}`:`What memories does this image "${s}" bring back?`},N=(t,d)=>{if(!d.autoTag)return["imported","image"];const i=["imported","image"],s=t.toLowerCase().replace(/\.[^/.]+$/,""),l=s.match(/(\d{4})[-_](\d{2})[-_](\d{2})/);return l&&i.push(`date:${l[1]}-${l[2]}-${l[3]}`),["family","wedding","birthday","vacation","holiday","party","graduation"].forEach(r=>{s.includes(r)&&i.push(r)}),i},v=async(t,d,i)=>{const s=[],l=t.split(/\n\s*\n/).filter(a=>a.trim().length>0);for(const a of l){const r=L(a);if(r.length<10)continue;const c=i.generatePrompts?`From your ${d} document:`:`Imported text from ${d}`,x=i.autoTag?w(r).concat(["imported","document"]):["imported","document"];s.push({prompt:c,response:r,type:"text",tags:x,date:i.preserveDates?new Date().toISOString():void 0})}return s},w=t=>{const d=t.toLowerCase().split(/\s+/),i=new Set(["the","and","or","but","in","on","at","to","for","of","with","by","an","a"]),s={};return d.forEach(a=>{const r=a.replace(/[^\w]/g,"");r.length>3&&!i.has(r)&&(s[r]=(s[r]||0)+1)}),Object.entries(s).sort(([,a],[,r])=>r-a).slice(0,3).map(([a])=>a)},B={importMemoriesFromFiles:G,extractMemoriesFromFile:j,generatePromptForImage:f,generateTagsForImage:N,extractMemoriesFromText:v,generateTagsFromText:w},K=({onBack:t})=>{const{user:d}=W(),{addToast:i}=$(),{dispatch:s}=C(),[l,a]=g.useState([]),[r,c]=g.useState({autoTag:!0,preserveDates:!1,generatePrompts:!0,batchSize:5}),[x,p]=g.useState(!1),[n,h]=g.useState(null),[u,I]=g.useState(!1),F=()=>{t?t():s({type:"SET_DETAIL_VIEW",payload:null})},S=o=>{a(m=>[...m,o])},k=async()=>{if(!(!(d!=null&&d.id)||l.length===0)){p(!0),h(null);try{const o=await B.importMemoriesFromFiles(l,d.id,r);h(o),o.success?(i({type:"success",title:"Import Complete!",message:`Successfully imported ${o.importedMemories} memories from ${l.length} files.`,duration:5e3}),a([])):i({type:"warning",title:"Import Completed with Issues",message:`Imported ${o.importedMemories} memories, but ${o.failedImports} failed. Check details below.`,duration:6e3})}catch(o){i({type:"error",title:"Import Failed",message:o.message||"An unexpected error occurred during import.",duration:5e3})}finally{p(!1)}}},T=()=>{a([]),h(null)};return e.jsxs("div",{className:"pt-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:F,className:"w-10 h-10 bg-white/80 backdrop-blur-xl rounded-2xl flex items-center justify-center shadow-lg border border-orange-100 hover:bg-orange-50 transition-colors","aria-label":"Go back",children:e.jsx(P,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Import Memories"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload photos and documents to create new memories"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-2xl flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Upload Files"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select photos and documents to import"})]})]}),e.jsx(R,{onFileProcessed:S,acceptedTypes:["image/*",".pdf",".txt",".doc",".docx"],maxFileSize:10,multiple:!0})]}),l.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-2xl flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Import Options"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize how your files are processed"})]})]}),e.jsxs("button",{onClick:()=>I(!u),className:"text-orange-600 hover:text-orange-700 font-medium text-sm",children:[u?"Hide":"Show"," Advanced"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:r.autoTag,onChange:o=>c(m=>({...m,autoTag:o.target.checked})),className:"w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Auto-generate tags"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:r.generatePrompts,onChange:o=>c(m=>({...m,generatePrompts:o.target.checked})),className:"w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Generate memory prompts"})]}),e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:r.preserveDates,onChange:o=>c(m=>({...m,preserveDates:o.target.checked})),className:"w-4 h-4 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Preserve file dates"})]})]}),u&&e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-800 mb-3",children:"Advanced Settings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Batch Size"}),e.jsxs("select",{value:r.batchSize,onChange:o=>c(m=>({...m,batchSize:parseInt(o.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:1,children:"1 file at a time"}),e.jsx("option",{value:3,children:"3 files"}),e.jsx("option",{value:5,children:"5 files"}),e.jsx("option",{value:10,children:"10 files"})]})]})})]})]})]}),l.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Ready to Import"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 rounded-2xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Import Summary:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:[l.length," files ready for import"]}),l.filter(o=>o.type==="image").length>0&&e.jsxs("li",{children:[l.filter(o=>o.type==="image").length," image files"]}),l.filter(o=>o.type==="document").length>0&&e.jsxs("li",{children:[l.filter(o=>o.type==="document").length," document files"]}),e.jsxs("li",{children:["Auto-tagging: ",r.autoTag?"Enabled":"Disabled"]}),e.jsxs("li",{children:["Memory prompts: ",r.generatePrompts?"Generated":"Simple"]})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:T,className:"flex-1 py-3 px-6 bg-gray-200 text-gray-700 rounded-2xl font-semibold hover:bg-gray-300 transition-all",disabled:x,children:"Clear Files"}),e.jsx("button",{onClick:k,disabled:x,className:"flex-1 flex items-center justify-center gap-3 py-3 px-6 bg-gradient-to-r from-orange-500 to-rose-500 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:x?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5"}),"Import Memories"]})})]})]})]}),n&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-2xl flex items-center justify-center ${n.success?"bg-gradient-to-br from-green-400 to-emerald-500":"bg-gradient-to-br from-amber-400 to-orange-500"}`,children:n.success?e.jsx(A,{className:"w-6 h-6 text-white"}):e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Import Results"}),e.jsx("p",{className:"text-sm text-gray-600",children:n.success?"Import completed successfully":"Import completed with some issues"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-3 text-center border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:n.importedMemories}),e.jsx("div",{className:"text-xs text-green-600",children:"Imported"})]}),e.jsxs("div",{className:"bg-red-50 rounded-xl p-3 text-center border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:n.failedImports}),e.jsx("div",{className:"text-xs text-red-600",children:"Failed"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3 text-center border border-blue-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:n.processedFiles.length}),e.jsx("div",{className:"text-xs text-blue-600",children:"Files"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center border border-gray-200",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:n.errors.length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Errors"})]})]}),n.errors.length>0&&e.jsxs("div",{className:"bg-red-50 rounded-2xl p-4 border border-red-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800 mb-2",children:"Errors:"}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1",children:[n.errors.slice(0,5).map((o,m)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 mt-1",children:"•"}),e.jsx("span",{children:o})]},m)),n.errors.length>5&&e.jsxs("li",{className:"text-red-600 font-medium",children:["... and ",n.errors.length-5," more errors"]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Import Tips"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"For Images:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Photos will create visual memory prompts"}),e.jsx("li",{children:"• Filenames with dates are automatically tagged"}),e.jsx("li",{children:'• Keywords like "family", "wedding" are detected'}),e.jsx("li",{children:"• Supported formats: JPG, PNG, GIF, WebP"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"For Documents:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Text files are split into memory entries"}),e.jsx("li",{children:"• Each paragraph becomes a separate memory"}),e.jsx("li",{children:"• Auto-generated tags from content keywords"}),e.jsx("li",{children:"• Supported formats: TXT, PDF (text-based)"})]})]})]})]})]})};export{K as default};
//# sourceMappingURL=MemoryImport-LAgzw7O-.js.map
