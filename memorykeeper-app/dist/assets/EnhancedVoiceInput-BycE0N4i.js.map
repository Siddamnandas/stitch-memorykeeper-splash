{"version":3,"file":"EnhancedVoiceInput-BycE0N4i.js","sources":["../../src/components/EnhancedVoiceInput.tsx"],"sourcesContent":["import { useState, useEffect, type FC } from 'react';\nimport { Mic, Square, History, RotateCcw } from 'lucide-react';\nimport { useTranslation } from 'react-i18next';\nimport { isSpeechRecognitionSupported } from '../lib/speechService';\nimport enhancedSpeechService from '../lib/enhancedSpeechService';\n\ninterface EnhancedVoiceInputProps {\n  onTranscript: (text: string) => void;\n  placeholder?: string;\n  className?: string;\n}\n\nconst EnhancedVoiceInput: FC<EnhancedVoiceInputProps> = ({\n  onTranscript,\n  placeholder = \"Speak to record your memory...\",\n  className = \"\"\n}) => {\n  const { t } = useTranslation();\n  const [isRecording, setIsRecording] = useState(false);\n  const [transcript, setTranscript] = useState('');\n  const [history, setHistory] = useState<any[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [showHistory, setShowHistory] = useState(false);\n  const [recordingDuration, setRecordingDuration] = useState(0);\n  const [detectedLanguage, setDetectedLanguage] = useState('en-US');\n\n  // Update recording duration when recording\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    \n    if (isRecording) {\n      interval = setInterval(() => {\n        setRecordingDuration(enhancedSpeechService.getRecordingDuration());\n      }, 100);\n    }\n    \n    return () => {\n      if (interval) clearInterval(interval);\n    };\n  }, [isRecording]);\n\n  // Load transcription history on mount\n  useEffect(() => {\n    setHistory(enhancedSpeechService.getTranscriptionHistory());\n  }, []);\n\n  const startRecording = async () => {\n    if (!isSpeechRecognitionSupported()) {\n      setError(t('voice.error.browserNotSupported'));\n      return;\n    }\n\n    try {\n      setError(null);\n      setTranscript('');\n      \n      // Detect language from existing text\n      const detectedLang = enhancedSpeechService.detectLanguage(transcript);\n      setDetectedLanguage(detectedLang);\n      \n      await enhancedSpeechService.startEnhancedSpeechRecognition(\n        (result) => {\n          const formattedTranscript = enhancedSpeechService.formatTranscript(result.transcript);\n          setTranscript(formattedTranscript);\n          onTranscript(formattedTranscript);\n        },\n        (err) => {\n          console.error('Speech recognition error:', err);\n          setError(t('voice.error.recognitionError'));\n          setIsRecording(false);\n        },\n        () => {\n          setIsRecording(false);\n          // Update history when recording stops\n          setHistory(enhancedSpeechService.getTranscriptionHistory());\n        },\n        {\n          lang: detectedLang,\n          continuous: true,\n          interimResults: true,\n          punctuationCorrection: true\n        }\n      );\n      \n      setIsRecording(true);\n    } catch (err: any) {\n      console.error('Error starting speech recognition:', err);\n      setError(err.message || t('voice.error.startRecordingError'));\n      setIsRecording(false);\n    }\n  };\n\n  const stopRecording = () => {\n    enhancedSpeechService.stopEnhancedSpeechRecognition();\n    setIsRecording(false);\n    // Update history when recording stops\n    setHistory(enhancedSpeechService.getTranscriptionHistory());\n  };\n\n  const clearHistory = () => {\n    enhancedSpeechService.clearTranscriptionHistory();\n    setHistory([]);\n  };\n\n  const applyHistoricalTranscript = (text: string) => {\n    setTranscript(text);\n    onTranscript(text);\n    setShowHistory(false);\n  };\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-xl p-3 text-red-700 text-sm\">\n          {error}\n        </div>\n      )}\n      \n      <div className=\"relative\">\n        <textarea\n          value={transcript}\n          onChange={(e) => setTranscript(e.target.value)}\n          placeholder={placeholder}\n          className=\"w-full p-4 bg-orange-50/50 rounded-2xl border border-orange-200 focus:border-orange-400 focus:ring-2 focus:ring-orange-200/50 outline-none resize-none transition-all min-h-[120px]\"\n        />\n        \n        <div className=\"absolute bottom-3 right-3 flex items-center gap-2\">\n          {isRecording && (\n            <div className=\"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full\">\n              {recordingDuration.toFixed(1)}s\n            </div>\n          )}\n          \n          <button\n            onClick={isRecording ? stopRecording : startRecording}\n            disabled={isRecording && recordingDuration > 29}\n            className={`p-2 rounded-full transition-all ${\n              isRecording\n                ? 'bg-red-500 text-white animate-pulse'\n                : 'bg-orange-100 text-orange-700 hover:bg-orange-200'\n            }`}\n            aria-label={isRecording ? t('voice.stopRecording') : t('voice.startRecording')}\n          >\n            {isRecording ? (\n              <Square className=\"w-5 h-5\" />\n            ) : (\n              <Mic className=\"w-5 h-5\" />\n            )}\n          </button>\n        </div>\n      </div>\n      \n      <div className=\"flex flex-wrap gap-2\">\n        <button\n          onClick={() => setShowHistory(!showHistory)}\n          className=\"flex items-center gap-1 px-3 py-2 bg-amber-100 text-amber-700 rounded-xl hover:bg-amber-200 transition-colors text-sm\"\n        >\n          <History className=\"w-4 h-4\" />\n          {t('voice.transcriptionHistory')}\n        </button>\n        \n        {history.length > 0 && (\n          <button\n            onClick={clearHistory}\n            className=\"flex items-center gap-1 px-3 py-2 bg-rose-100 text-rose-700 rounded-xl hover:bg-rose-200 transition-colors text-sm\"\n          >\n            <RotateCcw className=\"w-4 h-4\" />\n            {t('common.clear')}\n          </button>\n        )}\n        \n        <div className=\"text-xs text-gray-500 ml-2\">\n          {t('voice.detectedLanguage')}: {detectedLanguage}\n        </div>\n      </div>\n      \n      {showHistory && history.length > 0 && (\n        <div className=\"bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-orange-100 max-h-60 overflow-y-auto\">\n          <h3 className=\"font-semibold text-gray-800 mb-3\">{t('voice.transcriptionHistory')}</h3>\n          <div className=\"space-y-3\">\n            {history.slice().reverse().map((item) => (\n              <div \n                key={item.id}\n                className=\"p-3 bg-orange-50 rounded-xl cursor-pointer hover:bg-orange-100 transition-colors\"\n                onClick={() => applyHistoricalTranscript(item.text)}\n              >\n                <p className=\"text-gray-800 text-sm line-clamp-2\">{item.text}</p>\n                <div className=\"flex justify-between items-center mt-2 text-xs text-gray-500\">\n                  <span>{new Date(item.timestamp).toLocaleTimeString()}</span>\n                  <span>{(item.duration).toFixed(1)}s</span>\n                  <span>{Math.round(item.confidence * 100)}%</span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n      \n      {showHistory && history.length === 0 && (\n        <div className=\"bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-orange-100 text-center text-gray-500\">\n          {t('voice.history.empty')}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EnhancedVoiceInput;\n"],"names":["EnhancedVoiceInput","onTranscript","placeholder","className","useTranslation","isRecording","setIsRecording","useState","transcript","setTranscript","history","setHistory","error","setError","showHistory","setShowHistory","recordingDuration","setRecordingDuration","detectedLanguage","setDetectedLanguage","useEffect","interval","enhancedSpeechService","startRecording","isSpeechRecognitionSupported","detectedLang","result","formattedTranscript","err","stopRecording","clearHistory","applyHistoricalTranscript","text","jsxs","jsx","e","Square","Mic","History","RotateCcw","item"],"mappings":"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"}