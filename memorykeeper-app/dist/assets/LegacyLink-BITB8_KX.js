import{r as s,u as te,j as e,h as se,T as ne,l as re,a as ae,m as oe,Z as le,a0 as V,z as de,k as ie,X as ce}from"./ai-studio-D1VHpCnl.js";import{a as xe,i as me,j as ge,k as ue}from"./game-components-DlDolkYV.js";const he=({onBack:X})=>{const{user:x}=xe(),{state:l}=te(),p=l.memories[0],q=l.memoryStrength<40?"easy":l.memoryStrength<70?"medium":"hard",[r,b]=s.useState("ready"),[d,S]=s.useState([]),[h,C]=s.useState([]),[i,j]=s.useState(null),[N,w]=s.useState(""),[G,L]=s.useState(1),[F,T]=s.useState(0),[m,A]=s.useState(120),[D,M]=s.useState(0),[v,k]=s.useState(0),[Z,g]=s.useState(!1),[z,R]=s.useState(""),[o,$]=s.useState("guided"),{agentDecision:f,isVisible:B,showAgent:Y,hideAgent:I,requestHint:W,updateGameProgress:H,recordGameCompletion:J}=me({userId:(x==null?void 0:x.id)||"guest",gameId:"legacy-link",difficulty:q,currentMemory:p});s.useEffect(()=>{l.memoryStrength<40?$("guided"):l.memoryStrength<70?$("semi-guided"):$("free-form")},[l.memoryStrength]);const K=s.useCallback(()=>{const a=[{id:"central",text:(p==null?void 0:p.prompt)||"Your Memory",type:"memory",x:50,y:50,isCentral:!0}];if(o==="guided"||o==="semi-guided"){const y=o==="guided"?5:3,n=[{id:"person-1",text:"Family Member",type:"person",x:30,y:30},{id:"place-1",text:"Location",type:"place",x:70,y:30},{id:"emotion-1",text:"Feeling",type:"emotion",x:30,y:70},{id:"event-1",text:"Event",type:"event",x:70,y:70},{id:"concept-1",text:"Concept",type:"concept",x:50,y:20}];for(let c=0;c<y;c++)n[c]&&a.push({...n[c],x:n[c].x+(Math.random()*10-5),y:n[c].y+(Math.random()*10-5)})}S(a);const u=l.memoryStrength<40?180:l.memoryStrength<70?150:120;A(u)},[p,o,l.memoryStrength]),O=()=>{if(!N.trim())return;const t={id:`node-${Date.now()}`,text:N,type:"concept",x:20+Math.random()*60,y:20+Math.random()*60};S(a=>[...a,t]),w("")},Q=t=>{if(!i||i===t||h.some(n=>n.sourceId===i&&n.targetId===t||n.sourceId===t&&n.targetId===i))return;const u={id:`conn-${Date.now()}`,sourceId:i,targetId:t,strength:5};C(n=>[...n,u]),j(null);const y=8;T(n=>n+y),k(n=>n+1),d.length+h.length>=7&&(b("success"),R(`Great job! You've created a web of ${d.length} nodes and ${h.length} connections!`),g(!0),J(!0,120+G*30-m),x!=null&&x.id&&ue(x.id,F+v*5),setTimeout(()=>{g(!1),Y()},2e3))};s.useEffect(()=>{let t;return r==="playing"&&m>0?t=setTimeout(()=>A(a=>a-1),1e3):r==="playing"&&m===0&&(b("failed"),M(a=>a+1),k(0),R("Time's up! Try to create connections faster."),g(!0),Y()),()=>clearTimeout(t)},[r,m]),s.useEffect(()=>{r==="playing"&&H(d.length,D,v,m)},[d.length,D,v,m,r,H]);const P=()=>{b("playing"),T(0),L(1),M(0),k(0),C([]),j(null),w(""),g(!1),I(),K()},U=()=>{b("ready"),T(0),L(1),A(120),M(0),k(0),S([]),C([]),j(null),w(""),g(!1),I()},_=t=>{switch(t){case"memory":return"bg-gradient-to-br from-purple-500 to-indigo-500";case"person":return"bg-gradient-to-br from-blue-500 to-cyan-500";case"place":return"bg-gradient-to-br from-green-500 to-emerald-500";case"emotion":return"bg-gradient-to-br from-red-500 to-orange-500";case"event":return"bg-gradient-to-br from-yellow-500 to-amber-500";case"concept":return"bg-gradient-to-br from-pink-500 to-rose-500";default:return"bg-gradient-to-br from-gray-500 to-gray-600"}};return e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:X,className:"w-10 h-10 bg-white/80 backdrop-blur-xl rounded-2xl flex items-center justify-center shadow-lg border border-orange-100",children:e.jsx(se,{className:"w-6 h-6 text-gray-700"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Legacy Link"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ne,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-800",children:"Score"})]}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:F})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(re,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-800",children:"Level"})]}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:G})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(ae,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-800",children:"Streak"})]}),e.jsx("span",{className:"text-lg font-bold text-gray-800",children:v})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(oe,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-xs font-bold text-gray-800",children:"Time"})]}),e.jsxs("span",{className:"text-lg font-bold text-gray-800",children:[m,"s"]})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-3 shadow-lg border border-orange-100 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"font-bold text-gray-800",children:o==="guided"?"Guided Mode":o==="semi-guided"?"Semi-Guided Mode":"Free-Form Mode"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:o==="guided"?"AI suggests all nodes":o==="semi-guided"?"AI suggests some nodes":"Create your own nodes"})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-2xl flex items-center justify-center",children:e.jsx(V,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-800",children:"Legacy Link"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Connect related memories and concepts"})]})]}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["Create a web of connections between your memories and related concepts.",o==="guided"?" AI has suggested nodes for you to connect.":o==="semi-guided"?" AI has suggested some nodes, add your own connections.":" Create your own nodes and connections."]}),r==="ready"&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:P,className:"px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all flex items-center gap-2 mx-auto",children:[e.jsx(V,{className:"w-5 h-5"}),"Start Linking"]})}),r==="playing"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative h-96 bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl border-2 border-dashed border-purple-200 mb-6 overflow-hidden",children:[e.jsx("svg",{className:"absolute inset-0 w-full h-full",children:h.map(t=>{const a=d.find(E=>E.id===t.sourceId),u=d.find(E=>E.id===t.targetId);if(!a||!u)return null;const y=a.x/100*400,n=a.y/100*400,c=u.x/100*400,ee=u.y/100*400;return e.jsx("line",{x1:y,y1:n,x2:c,y2:ee,stroke:"#9333ea",strokeWidth:"2",strokeDasharray:t.strength>7?"none":"5,5"},t.id)})}),d.map(t=>e.jsx("div",{onClick:()=>{i?Q(t.id):j(t.id)},className:`absolute w-16 h-16 rounded-full flex items-center justify-center text-white text-xs font-bold text-center p-1 cursor-pointer transform -translate-x-1/2 -translate-y-1/2 transition-all ${_(t.type)} ${i===t.id?"ring-4 ring-yellow-400 scale-110":""} ${t.isCentral?"w-20 h-20":""}`,style:{left:`${t.x}%`,top:`${t.y}%`},children:e.jsx("span",{className:"truncate",children:t.text})},t.id)),e.jsx("div",{className:"absolute bottom-4 left-4 right-4 bg-black/50 text-white text-sm p-2 rounded-lg",children:i?"Select another node to connect":"Select a node to start connecting"})]}),(o==="free-form"||o==="semi-guided")&&e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("input",{type:"text",value:N,onChange:t=>w(t.target.value),placeholder:"Add a new concept...",className:"flex-1 px-4 py-2 bg-white border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx("button",{onClick:O,disabled:!N.trim(),className:"px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-2xl disabled:opacity-50",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-purple-50 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-bold text-purple-800",children:["Connections: ",h.length]}),e.jsxs("span",{className:"font-bold text-purple-800",children:["Nodes: ",d.length]})]}),e.jsx("div",{className:"w-full bg-purple-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 h-2 rounded-full",style:{width:`${Math.min(100,h.length/7*100)}%`}})}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"Complete 7 connections to finish the level"})]})]}),Z&&e.jsxs("div",{className:`mt-6 p-4 rounded-2xl text-center ${r==="success"?"bg-green-100":"bg-red-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[r==="success"?e.jsx(ie,{className:"w-6 h-6 text-green-600"}):e.jsx(ce,{className:"w-6 h-6 text-red-600"}),e.jsx("span",{className:`font-bold ${r==="success"?"text-green-800":"text-red-800"}`,children:r==="success"?"Excellent!":"Try Again"})]}),e.jsx("p",{className:r==="success"?"text-green-700":"text-red-700",children:z})]}),r==="success"&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>{L(t=>t+1),g(!1),P()},className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all",children:"Next Level"})}),r==="failed"&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>{g(!1),b("playing")},className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-rose-500 text-white font-bold rounded-2xl shadow-lg hover:shadow-xl transition-all",children:"Try Again"})})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsx("button",{onClick:U,className:"px-6 py-2 bg-gray-200 text-gray-700 font-bold rounded-xl hover:bg-gray-300 transition-all",children:"Reset Game"})}),f&&e.jsx(ge,{hint:f.hint,scaffolding:f.scaffolding,agentMessage:f.agentMessage,agentType:f.agentType,isVisible:B,onDismiss:I,onRequestHint:W}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3",children:"How to Play"}),e.jsxs("ul",{className:"text-gray-700 space-y-2 text-sm",children:[e.jsx("li",{children:"• Click on a node to select it, then click another node to create a connection"}),e.jsx("li",{children:"• Create connections between related memories and concepts"}),e.jsx("li",{children:"• Add your own concepts in free-form mode"}),e.jsx("li",{children:"• Complete 7 connections to finish the level"})]})]})]})},fe=s.memo(he);export{fe as default};
//# sourceMappingURL=LegacyLink-BITB8_KX.js.map
