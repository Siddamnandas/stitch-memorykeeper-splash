import{n as z,r as n,j as r,w as L,I as M,F as T,x as W,X as $}from"./ai-studio-Dqe0xBOf.js";import{a as B}from"./game-components-Cb-CYX2n.js";import{s as O}from"./index-Bi1L0x_1.js";const q=({onFileProcessed:f,acceptedTypes:m=["image/*",".pdf",".txt"],maxFileSize:x=10,multiple:u=!1})=>{const{user:i}=B(),{addToast:l}=z(),[j,g]=n.useState(!1),[N,b]=n.useState(!1),[y,h]=n.useState([]),v=n.useRef(null),F=x*1024*1024,E=e=>e.size>F?`File size exceeds ${x}MB limit`:m.some(a=>{if(a.startsWith("."))return e.name.toLowerCase().endsWith(a.toLowerCase());if(a.includes("*")){const s=a.split("/")[0];return e.type.startsWith(s)}return e.type===a})?null:`File type not supported. Accepted types: ${m.join(", ")}`,C=async e=>{const t=E(e);if(t)return l({type:"error",title:"Invalid File",message:t,duration:4e3}),null;const a=e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":"document",s={file:e,type:a,metadata:{name:O(e.name),size:e.size,lastModified:e.lastModified,type:e.type}};if(s.type==="image")try{const o=await w(e);s.preview=o}catch(o){console.error("Error creating image preview:",o)}if(s.type==="video")try{const o=await w(e);s.preview=o}catch(o){console.error("Error creating video preview:",o)}if(e.type==="text/plain"||e.name.toLowerCase().endsWith(".txt"))try{const o=await D(e);s.textContent=o}catch(o){console.error("Error reading text file:",o)}return s},w=e=>new Promise((t,a)=>{const s=new FileReader;s.onload=o=>{var d;const c=(d=o.target)==null?void 0:d.result;c?t(c):a(new Error("Failed to create image preview"))},s.onerror=()=>a(new Error("Failed to read image file")),s.readAsDataURL(e)}),D=e=>new Promise((t,a)=>{const s=new FileReader;s.onload=o=>{var d;const c=(d=o.target)==null?void 0:d.result;c?t(c):a(new Error("Failed to read text file"))},s.onerror=()=>a(new Error("Failed to read text file")),s.readAsText(e)}),p=n.useCallback(async e=>{if(!(i!=null&&i.id)){l({type:"error",title:"Authentication Required",message:"Please sign in to upload files.",duration:4e3});return}const t=Array.from(e);b(!0);const a=[];for(const s of t)try{const o=await C(s);o&&a.push(o)}catch(o){console.error("Error processing file:",o),l({type:"error",title:"Processing Error",message:`Failed to process ${s.name}`,duration:4e3})}b(!1),a.length>0&&(h(u?s=>[...s,...a]:[a[0]]),a.forEach(s=>{f(s)}),l({type:"success",title:"Files Processed",message:`Successfully processed ${a.length} file(s).`,duration:3e3}))},[i==null?void 0:i.id,u,f,l]),k=n.useCallback(e=>{e.preventDefault(),g(!1);const t=e.dataTransfer.files;t.length>0&&p(t)},[p]),P=n.useCallback(e=>{e.preventDefault(),g(!0)},[]),A=n.useCallback(e=>{e.preventDefault(),g(!1)},[]),I=n.useCallback(e=>{const t=e.target.files;t&&t.length>0&&p(t)},[p]),R=e=>{h(t=>t.filter((a,s)=>s!==e))};return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:`border-2 border-dashed rounded-2xl p-8 text-center transition-all ${j?"border-orange-400 bg-orange-50":"border-gray-300 bg-white/80 backdrop-blur-xl"}`,onDrop:k,onDragOver:P,onDragLeave:A,children:[r.jsx("input",{type:"file",ref:v,className:"hidden",accept:m.join(","),multiple:u,onChange:I}),r.jsx(L,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Drag & drop files here"}),r.jsxs("p",{className:"text-gray-500 mb-4",children:["or"," ",r.jsx("button",{type:"button",className:"text-orange-600 hover:text-orange-700 font-medium",onClick:()=>{var e;return(e=v.current)==null?void 0:e.click()},children:"browse files"})]}),r.jsxs("p",{className:"text-sm text-gray-400",children:["Accepted types: ",m.join(", ")," | Max size: ",x,"MB"]})]}),N&&r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-4 flex items-center gap-3",children:[r.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"text-blue-700",children:"Processing files..."})]}),y.length>0&&r.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-orange-100",children:[r.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Uploaded Files"}),r.jsx("div",{className:"space-y-3",children:y.map((e,t)=>r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 rounded-xl",children:[r.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-white",children:e.type==="image"?r.jsx(M,{className:"w-5 h-5 text-orange-600"}):r.jsx(T,{className:"w-5 h-5 text-orange-600"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-medium text-gray-800 truncate",children:e.metadata.name}),r.jsxs("p",{className:"text-sm text-gray-500",children:[(e.metadata.size/1024/1024).toFixed(2)," MB"]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[e.preview&&r.jsx("button",{className:"p-2 text-gray-500 hover:text-gray-700",children:r.jsx(W,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>R(t),className:"p-2 text-gray-500 hover:text-red-500",children:r.jsx($,{className:"w-4 h-4"})})]})]},t))})]})]})};export{q as default};
//# sourceMappingURL=FileUpload-DOtEzTE4.js.map
