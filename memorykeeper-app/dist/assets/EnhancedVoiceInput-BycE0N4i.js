import{r as s,j as e,aB as T,f as C,aC as k,a as L}from"./ai-studio-D1VHpCnl.js";import{a as D,g as o,h as I}from"./index-BYmrHuMl.js";import"./game-components-DlDolkYV.js";const q=({onTranscript:u,placeholder:v="Speak to record your memory...",className:y=""})=>{const{t}=D(),[a,n]=s.useState(!1),[p,i]=s.useState(""),[c,l]=s.useState([]),[h,d]=s.useState(null),[g,m]=s.useState(!1),[b,j]=s.useState(0),[N,S]=s.useState("en-US");s.useEffect(()=>{let r;return a&&(r=setInterval(()=>{j(o.getRecordingDuration())},100)),()=>{r&&clearInterval(r)}},[a]),s.useEffect(()=>{l(o.getTranscriptionHistory())},[]);const w=async()=>{if(!I()){d(t("voice.error.browserNotSupported"));return}try{d(null),i("");const r=o.detectLanguage(p);S(r),await o.startEnhancedSpeechRecognition(x=>{const f=o.formatTranscript(x.transcript);i(f),u(f)},x=>{console.error("Speech recognition error:",x),d(t("voice.error.recognitionError")),n(!1)},()=>{n(!1),l(o.getTranscriptionHistory())},{lang:r,continuous:!0,interimResults:!0,punctuationCorrection:!0}),n(!0)}catch(r){console.error("Error starting speech recognition:",r),d(r.message||t("voice.error.startRecordingError")),n(!1)}},R=()=>{o.stopEnhancedSpeechRecognition(),n(!1),l(o.getTranscriptionHistory())},H=()=>{o.clearTranscriptionHistory(),l([])},E=r=>{i(r),u(r),m(!1)};return e.jsxs("div",{className:`space-y-4 ${y}`,children:[h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3 text-red-700 text-sm",children:h}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:p,onChange:r=>i(r.target.value),placeholder:v,className:"w-full p-4 bg-orange-50/50 rounded-2xl border border-orange-200 focus:border-orange-400 focus:ring-2 focus:ring-orange-200/50 outline-none resize-none transition-all min-h-[120px]"}),e.jsxs("div",{className:"absolute bottom-3 right-3 flex items-center gap-2",children:[a&&e.jsxs("div",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full",children:[b.toFixed(1),"s"]}),e.jsx("button",{onClick:a?R:w,disabled:a&&b>29,className:`p-2 rounded-full transition-all ${a?"bg-red-500 text-white animate-pulse":"bg-orange-100 text-orange-700 hover:bg-orange-200"}`,"aria-label":t(a?"voice.stopRecording":"voice.startRecording"),children:a?e.jsx(T,{className:"w-5 h-5"}):e.jsx(C,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>m(!g),className:"flex items-center gap-1 px-3 py-2 bg-amber-100 text-amber-700 rounded-xl hover:bg-amber-200 transition-colors text-sm",children:[e.jsx(k,{className:"w-4 h-4"}),t("voice.transcriptionHistory")]}),c.length>0&&e.jsxs("button",{onClick:H,className:"flex items-center gap-1 px-3 py-2 bg-rose-100 text-rose-700 rounded-xl hover:bg-rose-200 transition-colors text-sm",children:[e.jsx(L,{className:"w-4 h-4"}),t("common.clear")]}),e.jsxs("div",{className:"text-xs text-gray-500 ml-2",children:[t("voice.detectedLanguage"),": ",N]})]}),g&&c.length>0&&e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-orange-100 max-h-60 overflow-y-auto",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:t("voice.transcriptionHistory")}),e.jsx("div",{className:"space-y-3",children:c.slice().reverse().map(r=>e.jsxs("div",{className:"p-3 bg-orange-50 rounded-xl cursor-pointer hover:bg-orange-100 transition-colors",onClick:()=>E(r.text),children:[e.jsx("p",{className:"text-gray-800 text-sm line-clamp-2",children:r.text}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:new Date(r.timestamp).toLocaleTimeString()}),e.jsxs("span",{children:[r.duration.toFixed(1),"s"]}),e.jsxs("span",{children:[Math.round(r.confidence*100),"%"]})]})]},r.id))})]}),g&&c.length===0&&e.jsx("div",{className:"bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-orange-100 text-center text-gray-500",children:t("voice.history.empty")})]})};export{q as default};
//# sourceMappingURL=EnhancedVoiceInput-BycE0N4i.js.map
