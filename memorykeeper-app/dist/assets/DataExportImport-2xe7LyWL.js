const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/game-components-DlDolkYV.js","assets/ai-studio-D1VHpCnl.js"])))=>i.map(i=>d[i]);
import{c as F,u as S,r as x,j as e,h as M,ab as b,au as y,av as j,y as w,F as B,k as C}from"./ai-studio-D1VHpCnl.js";import{_ as A,g as P,w as _,a as $}from"./game-components-DlDolkYV.js";const v=async()=>{try{const a=await P(),r=await _(),t={memories:a,profile:r,exportDate:new Date().toISOString(),version:"1.0"};return JSON.stringify(t,null,2)}catch(a){throw console.error("Error exporting backup data:",a),new Error("Failed to export backup data")}},L=async a=>{try{const r=await v(),t=`memorykeeper-backup-${new Date().toISOString().split("T")[0]}.json`,m=a||t,d=new Blob([r],{type:"application/json"}),c=URL.createObjectURL(d),l=document.createElement("a");l.href=c,l.download=m,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c)}catch(r){throw console.error("Error downloading backup file:",r),new Error("Failed to download backup file")}},O=a=>{try{const r=JSON.parse(a);if(!r.memories||!Array.isArray(r.memories))throw new Error("Invalid backup data: memories array missing");if(!r.exportDate)throw new Error("Invalid backup data: export date missing");return r}catch(r){throw console.error("Error parsing backup data:",r),new Error("Invalid backup file format")}},R=async a=>{const r={importedMemories:0,importedProfile:!1,skippedMemories:0,errors:[]};try{const{addSingleMemory:t,saveProfile:m,getAllMemories:d}=await A(async()=>{const{addSingleMemory:o,saveProfile:i,getAllMemories:p}=await import("./game-components-DlDolkYV.js").then(n=>n.x);return{addSingleMemory:o,saveProfile:i,getAllMemories:p}},__vite__mapDeps([0,1]));if(!Array.isArray(a.memories))return r.errors.push("Invalid backup data: memories array missing"),r;const c=await d(),l=new Set(c.map(o=>o.id));for(const o of a.memories)try{if(l.has(o.id)){r.skippedMemories++;continue}if(!o.prompt||!o.response){r.errors.push(`Invalid memory data for ID ${o.id}`);continue}await t(o)?r.importedMemories++:r.errors.push(`Failed to import memory "${o.prompt}"`)}catch(i){r.errors.push(`Error importing memory: ${i.message}`)}if(a.profile)try{await m(a.profile),r.importedProfile=!0}catch(o){r.errors.push(`Failed to import profile: ${o.message}`)}}catch(t){r.errors.push(`Import failed: ${t.message}`)}return r},g={exportBackupData:v,downloadBackupFile:L,parseBackupData:O,importBackupData:R},J=({onBack:a})=>{const{user:r}=$(),{addToast:t}=F(),{dispatch:m}=S(),[d,c]=x.useState(!1),[l,o]=x.useState(!1),[i,p]=x.useState(null),n=x.useRef(null),k=()=>{a?a():m({type:"SET_DETAIL_VIEW",payload:null})},N=async()=>{if(r!=null&&r.id){c(!0);try{await g.downloadBackupFile(),t({type:"success",title:"Backup Downloaded",message:"Your memories have been exported successfully!",duration:4e3})}catch(s){console.error("Export error:",s),t({type:"error",title:"Export Failed",message:s.message||"Failed to export your data.",duration:5e3})}finally{c(!1)}}},I=async s=>{var f;const h=(f=s.target.files)==null?void 0:f[0];if(h){if(!h.name.endsWith(".json")){t({type:"error",title:"Invalid File",message:"Please select a valid JSON backup file.",duration:4e3});return}try{const u=await h.text(),D=g.parseBackupData(u);p(D)}catch(u){t({type:"error",title:"Invalid Backup File",message:u.message||"The selected file is not a valid backup.",duration:5e3})}}},E=async()=>{if(i){o(!0);try{const s=await g.importBackupData(i);s.errors.length>0?(t({type:"warning",title:"Import Completed with Issues",message:`Imported ${s.importedMemories} memories. ${s.skippedMemories} skipped. Check console for details.`,duration:6e3}),console.warn("Import errors:",s.errors)):t({type:"success",title:"Import Complete",message:`Successfully imported ${s.importedMemories} memories${s.importedProfile?" and profile data":""}.`,duration:5e3}),p(null),n.current&&(n.current.value="")}catch(s){t({type:"error",title:"Import Failed",message:s.message||"Failed to import backup data.",duration:5e3})}finally{o(!1)}}};return e.jsxs("div",{className:"pt-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:k,className:"w-10 h-10 bg-white/80 backdrop-blur-xl rounded-2xl flex items-center justify-center shadow-lg border border-orange-100 hover:bg-orange-50 transition-colors","aria-label":"Go back",children:e.jsx(M,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Data Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Backup your memories or import from another device"})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-400 to-emerald-500 rounded-2xl flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Export Backup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Download all your memories and data"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-amber-50 rounded-2xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Backup includes all memories, profile data, and settings"}),e.jsx("li",{children:"File will be downloaded as JSON format"}),e.jsx("li",{children:"Keep backups safe and private"})]})]})]})}),e.jsx("button",{onClick:N,disabled:d,className:"w-full flex items-center justify-center gap-3 py-4 px-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:d?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5 animate-spin"}),"Creating Backup..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5"}),"Download Backup"]})})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl p-6 shadow-xl border border-orange-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-2xl flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Import Backup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Restore memories from a backup file"})]})]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 rounded-2xl p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Backup Preview:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Memories:"})," ",i.memories.length]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Profile:"})," ",i.profile?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Exported:"})," ",new Date(i.exportDate).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"bg-amber-50 rounded-2xl p-4 border border-amber-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Import Warning:"}),e.jsx("p",{children:"This will merge data with your existing memories. Duplicate entries will be handled automatically."})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{p(null),n.current&&(n.current.value="")},className:"flex-1 py-3 px-6 bg-gray-200 text-gray-700 rounded-2xl font-semibold hover:bg-gray-300 transition-all",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:l,className:"flex-1 flex items-center justify-center gap-3 py-3 px-6 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:l?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-5 h-5"}),"Import Data"]})})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Select a MemoryKeeper backup file (.json)"}),e.jsx("input",{ref:n,type:"file",accept:".json",onChange:I,className:"hidden"}),e.jsx("button",{onClick:()=>{var s;return(s=n.current)==null?void 0:s.click()},className:"py-3 px-6 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all",children:"Choose File"})]})})]})]})};export{J as default};
//# sourceMappingURL=DataExportImport-2xe7LyWL.js.map
